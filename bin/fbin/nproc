#!/bin/sh
# nproc - fallback 'nproc' util for coreutils < 8.0

if [ -n "$OMP_NUM_THREADS" ]; then
	echo $OMP_NUM_THREADS
	exit
fi

case `uname` in
Linux)
	exec getconf _NPROCESSORS_ONLN
	;;
FreeBSD|NetBSD)
	exec /sbin/sysctl -n hw.ncpu
	;;
Darwin)
	# http://lists.apple.com/archives/darwin-dev/2007/Jun/msg00088.html
	# hw.ncpu - "consider it to be deprecated"
	# hw.physicalcpu - physical processors installed
	# hw.availcpu - logical processors online
	exec /sbin/sysctl -n hw.availcpu
	;;
SunOS)
	exec /usr/sbin/psrinfo -p
	;;
*)
	echo "fbin/nproc: unsupported OS '`uname`'" >&2
	echo 1
	;;
esac
