#!/bin/bash -ex

repo=git://git.sv.gnu.org/weechat.git
src=~/src/weechat
prefix=~/lib/weechat
ruby=$(which ruby)

if [ -d "$src" ]; then
	cd "$src"
	git pull
else
	git clone "$repo" "$src"
	cd "$src"
fi
git checkout -f
git clean -fdx

mkdir build
cd build

cmake .. -DPREFIX="$prefix" -DRUBY_EXECUTABLE="$ruby" \
	-DENABLE_NLS=OFF -DCMAKE_BUILD_TYPE=Debug

make
make install
