#!/usr/bin/env bash
set -e

link() {
	local target="$dir/${1%/}" link=$2
	if [ -e "$link" ] && [ ! -h "$link" ] && ! $force; then
		echo "Not overwriting $link" >&2
	else
		rm -f "$link"
		sym -f "$target" "$link"
	fi
}

sym() { "$dir/sym.pl" "$@"; }

dir=~/code
all=false
force=false

while getopts ad:f OPT; do
	case $OPT in
	a)	all=true;;
	d)	dir=$OPTARG;;
	f)	force=true;;
	esac
done

mkdir -p ~/bin ~/lib
mkdir -pm 0700 ~/tmp

make all

link	bin/args		~/bin/args
link	bin/bgrep		~/bin/bgrep
link	tools/getnetrc.pl	~/bin/getnetrc
link	getpaste.pl		~/bin/getpaste
link	tools/getsession.sh	~/bin/getsession
link	gist.pl			~/bin/gist
link	tools/nbls.pl		~/bin/nbls
link	rdt.php			~/bin/rdt
link	bin/silentcat		~/bin/silentcat
link	sym.pl			~/bin/sym
link	tools/urlencode.pl	~/bin/urlencode

if { which python2 && ! which python; } >& /dev/null; then
	ln -sf "$(which python)" ~/bin/python2
fi
