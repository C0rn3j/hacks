#!/usr/bin/env bash
PATH="$HOME/bin:$HOME/usr/bin:$PATH"
dir="$HOME/code"
set -e
exec 1>/dev/null

cd "$dir"

oldhead=$(git rev-parse HEAD)
if [[ $(git --version | sed 's/^git version //') == 1.5.* ]]; then
	git pull >& /dev/null
else
	git pull -q
fi
newhead=$(git rev-parse HEAD)

"$dir/sshupdate" || {
	echo >&2 "sshupdate failed [$?]"
	exit 1
}
"$dir/tools/dotrc" || {
	echo >&2 "dotrc failed [$?]"
	exit 1
}

if [[ $oldhead != $newhead ]]; then
	if [[ -f ~/tmp/rwhod-${HOSTNAME}.pid ]]; then
		"$dir/useless/rwho/rwhod.sh" update
	fi
fi

true
