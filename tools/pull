#!/bin/bash
PATH="$HOME/bin:$HOME/usr/bin:$PATH"
dir="$HOME/code"
set -e

cd "$dir"

oldhead=$(git rev-parse HEAD)
if [[ $(git --version | sed 's/^git version //') == 1.5.* ]]; then
	git pull >& /dev/null
else
	git pull -q
fi
newhead=$(git rev-parse HEAD)

"$dir/sshupdate"
"$dir/tools/dotrc"

if [[ $oldhead != $newhead ]]; then
	if [[ -f ~/tmp/rwhod-${HOSTNAME}.pid ]]; then
		"$dir/useless/rwho/rwhod.sh" restart
	fi
fi
