#!/usr/bin/env perl
# progress - summarize line-based stdout to one dynamic progress line

$| = 1;

$width = int(`stty size </dev/tty | awk '{print \$2}'`);
$count = 0;
$last = time;

$SIG{INT} = sub {
	printf("\r\033[K%s\n", "$count items (interrupted)");
	exit 1;
};

while (++$count, $str = <STDIN>) {
	$now = time;
	next if $now - $last < 1;
	$last = $now;

	chomp($str);
	$pre = sprintf("%d ", $count);
	$str = substr($str, 0, $width - length($pre));
	printf("\r\033[K%s%s\r", $pre, $str);
}

printf("\r\033[K%s\n", "$count items");
