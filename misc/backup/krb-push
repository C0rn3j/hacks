#!/usr/bin/env bash
umask 077
realm=$1
keyid=$2

if ! [[ $realm && $keyid ]]; then
	echo "error: usage: krb-push <realm> <gpgkeyid>" >&2
	exit 1
fi

if [[ -t 1 ]]; then
	echo "error: will not write to a tty"
	exit 1
fi

sudo kdb5_util -r "$realm" dump |
	gpg --encrypt -r "$keyid" --batch |
	gpg --store
	# very simple check against truncation
